(function(){"use strict";angular.module("app").controller("registerController",registerController);registerController.$inject=["$routeParams","$scope","$filter","$uibModal","$location","vcRecaptchaService","growl","AuthService","Utils","REST","$route","$timeout"];function registerController($routeParams,$scope,$filter,$uibModal,$location,vcRecaptchaService,growl,AuthService,Utils,REST,$route,$timeout){var vm=this;if($location.$$path==="/registro"){vm.segmen=1}vm.activeTab=1;vm.stepOne=[];vm.stepTwo=[];vm.stepThree=[];vm.stepOne.complete=false;vm.stepTwo.complete=false;vm.response=null;vm.widgetId=null;vm.segment=$routeParams.segment;if(vm.segment===""){vm.segmen=1}vm.model={key:REST.KEY};vm.setResponse=function(response){vm.response=response};vm.setWidgetId=function(widgetId){vm.widgetId=widgetId};vm.cbExpiration=function(){vcRecaptchaService.reload(vm.widgetId);vm.response=null};init();function init(){getCountries();getDepartments(1);getDepartmentsFrom(1);getDepartmentsDueDate(1)}function getCountries(){Utils.getCountries().then(function(data){vm.countries=data;vm.stepTwo.country=data[45].pais_id})}function getDepartments(idCountry){Utils.getDepartment(idCountry).then(function(data){vm.departments=data}).catch(function(data){console.log(data)})}function getDepartmentsFrom(idCountry){Utils.getDepartment(idCountry).then(function(data){vm.departmentsFrom=data;vm.stepTwo.departments=1}).catch(function(data){console.log(data)})}function getDepartmentsDueDate(idCountry){Utils.getDepartment(idCountry).then(function(data){vm.departmentsDueDate=data;vm.stepTwo.departments=1}).catch(function(data){console.log(data)})}vm.dateOptions={formatYear:"yy",startingDay:1};vm.format="yyyy-MM-dd";vm.open=function(object){object.opened=true};vm.dateExp={opened:false};vm.birthDate={opened:false};vm.duedate={opened:false};vm.selectTab=function(id){vm.activeTab=id};vm.setCountry=function(){vm.departmentsFrom=getDepartmentsFrom(vm.stepTwo.country)};vm.setDepartment=function(){Utils.getCityCode(vm.stepTwo.department).then(function(data){vm.zipcodes=data.codigos;vm.cities=data.ciudades}).catch(function(data){console.log(data)})};vm.setDepartmentExp=function(){Utils.getCityCode(vm.stepOne.departmentExp).then(function(data){vm.citiesExp=data.ciudades}).catch(function(data){console.log(data)})};vm.setDepartmentFrom=function(){Utils.getCityCode(vm.stepTwo.departmentFrom).then(function(data){vm.citiesFrom=data.ciudades}).catch(function(data){console.log(data)})};vm.nextStep=function(){vm.activeTab=vm.activeTab%3+1};vm.openTerms=function(){var modalInstance=$uibModal.open({ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"app/views/terms_conditions.modal.html",controller:"modalTyCController",controllerAs:"info",size:"lg"});modalInstance.result.then(function(result){vm.stepThree.tyc=result},function(){console.log("failed")})};function validateCaptcha(){Utils.validateCaptcha(vm.stepThree.captcha.response).then(complete).catch(failed);function complete(data){}function failed(data){console.log(data)}}vm.recaptcha=function(){vcRecaptchaService.reload(widgetId)};vm.submit=function(){var userRegister=[];userRegister.segment=vm.segment;userRegister.one=vm.stepOne;userRegister.two=vm.stepTwo;userRegister.three=vm.stepThree;userRegister.three.captcha=vcRecaptchaService.getResponse();userRegister.one.duedate=$filter("date")(userRegister.one.duedate,"yyyy-MM-dd");userRegister.one.date=$filter("date")(userRegister.one.dateExp,"yyyy-MM-dd");userRegister.two.date=$filter("date")(userRegister.two.birthDate,"yyyy-MM-dd");AuthService.register(userRegister).then(complete).catch(failed);function complete(data){var config={referenceId:1};if(data.state==1){growl.success(data.msg,{});$timeout(function(){$route.reload()},5e3)}else{growl.error(data.msg,config)}}function failed(data){console.log(data)}}}})();