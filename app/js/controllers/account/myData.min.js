(function(){"use strict";angular.module("app").controller("myDataController",myDataController);myDataController.$inject=["$rootScope","$scope","$location","$filter","AuthService","GameAccount","Utils","growl","REST","$timeout","$route"];function myDataController($rootScope,$scope,$location,$filter,AuthService,GameAccount,Utils,growl,REST,$timeout,$route){var vm=this;vm.activeTab=1;vm.user={};vm.user.department=null;vm.timeConnected=0;vm.stepOne=[];vm.stepTwo=[];vm.stepOne.complete=false;vm.stepTwo.complete=false;init();function init(){getAuxInfo();getCountries();getProfile()}function getAuxInfo(){var aux=[{value:1,option:"Masculino"},{value:2,option:"Femenino"}];vm.gender=aux;aux=[{value:1,option:"Cedula de Ciudadanía"},{value:2,option:"Cedula de Extranjería"}];vm.documentType=aux}function getProfile(){GameAccount.getProfile($rootScope.id,$rootScope.tokenSession).then(complete).catch(failed);function complete(response){var data=response.dato;var time=response.time;if(data.tipo_registro==1){vm.stepOne.disabled=true}getDepartments(data.pais);getDepartmentsFrom(data.pais);getDepartmentsDueDate(data.pais);vm.lastConnection=time.fecha_fin;vm.timeConnected=time.tiempo;vm.stepOne.firstName=data.pNom;vm.stepOne.secondName=data.sNom;vm.stepOne.lastname=data.pApe;vm.stepOne.secondLastname=data.sApe;vm.stepOne.gender=parseInt(data.sexo);vm.stepOne.documentType=parseInt(data.tipo_doc);vm.stepOne.identity=data.numDoc;vm.stepOne.email=data.email;vm.stepTwo.country=data.pais;vm.stepTwo.department=data.depart_res;vm.setDepartment();vm.stepTwo.city=data.ciudad_res;vm.stepTwo.address=data.dir;vm.stepTwo.zipcode=data.cod_postal;vm.setDepartmentFrom();vm.stepTwo.phone=data.fijo;vm.stepTwo.mobile=data.movil;vm.stepTwo.referred=data.referido_id}function failed(data){}}function getCountries(){Utils.getCountries().then(function(data){vm.countries=data;vm.stepTwo.country=data[45].pais_id}).catch(function(data){console.log(data)})}function getDepartments(idCountry){Utils.getDepartment(idCountry).then(function(data){vm.departments=data;vm.stepTwo.departments=1}).catch(function(data){console.log(data)})}function getDepartmentsFrom(idCountry){Utils.getDepartment(idCountry).then(function(data){vm.departmentsFrom=data;vm.stepTwo.departments=1}).catch(function(data){console.log(data)})}function getDepartmentsDueDate(idCountry){Utils.getDepartment(idCountry).then(function(data){vm.departmentsDueDate=data;vm.stepTwo.departments=1}).catch(function(data){console.log(data)})}vm.dateOptions={formatYear:"yy",startingDay:1};vm.format="yyyy-MM-dd";vm.open=function(object){object.opened=true};vm.dateExp={opened:false};vm.birthDate={opened:false};vm.duedate={opened:false};vm.selectTab=function(id){vm.activeTab=id};vm.setCountry=function(){vm.departmentsFrom=getDepartmentsFrom(vm.stepTwo.country)};vm.setDepartment=function(){Utils.getCityCode(vm.stepTwo.department).then(function(data){vm.zipcodes=data.codigos;vm.cities=data.ciudades}).catch(function(data){console.log(data)})};vm.setDepartmentExp=function(){Utils.getCityCode(vm.stepOne.departmentExp).then(function(data){vm.citiesExp=data.ciudades}).catch(function(data){console.log(data)})};vm.setDepartmentFrom=function(){Utils.getCityCode(vm.stepTwo.departmentFrom).then(function(data){vm.citiesFrom=data.ciudades}).catch(function(data){console.log(data)})};vm.nextStep=function(){vm.activeTab=vm.activeTab%3+1};vm.submit=function(){var userProfile=[];userProfile.one=vm.stepOne;userProfile.two=vm.stepTwo;GameAccount.setshortProfile($rootScope.id,$rootScope.tokenSession,userProfile).then(complete).catch(failed);function complete(data){var config={referenceId:1};if(data.state==1){growl.success(data.msg);$timeout(function(){$route.reload()},4e3)}else{if(data.state==99){$location.path("/")}else{growl.error(data.msg)}}}function failed(data){console.log(data)}}}})();